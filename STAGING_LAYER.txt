-- CUSTOMER_DIM--
--CREATE TABLE STG_CUSTOMERS AS 
TRUNCATE TABLE STG_CUSTOMERS;
INSERT INTO STG_CUSTOMERS
SELECT CUS.ID AS CUSTOMER_ID, CUS.CUSTOMER_NAME, CUS.USERNAME,CUS.SEGMENT,P.POSTAL_CODE,C.CITY,C.STATE,C.REGION,C.COUNTRY
FROM RAW.PINCODES P 
INNER JOIN RAW.CITIES C ON P.CITY_ID = C.ID
INNER JOIN RAW.CUSTOMERS CUS ON CUS.PINCODE_ID = P.ID
WHERE P.LAST_UPDATED_AT = CURRENT_DATE +1 OR C.LAST_UPDATED_AT = CURRENT_DATE +1 OR CUS.LAST_UPDATED_AT = CURRENT_DATE +1; 

SELECT * FROM STG_CUSTOMERS

--PRODUCT_DIM--
--CREATE TABLE STG_PRODUCTS AS
TRUNCATE TABLE STG_PRODUCTS;
INSERT INTO STG_PRODUCTS
SELECT P.ID AS PRODUCT_ID, P.PRODUCT_NAME, P.PRICE, S.SUB_CATEGORY,S.CATEGORY
FROM RAW.PRODUCTS P 
INNER JOIN RAW.SUBCATEGORIES S ON P.SUB_CATEGORY_ID = S.ID
WHERE P.LAST_UPDATED_AT = CURRENT_DATE+1 OR S.LAST_UPDATED_AT = CURRENT_DATE+1

--ORDERS_DIM--
--CREATE TABLE STG_ORDERS AS 
TRUNCATE TABLE STG_ORDERS;
INSERT INTO STG_ORDERS
SELECT O.ORDER_ID, O.ORDER_NUMBER, O.ORDER_DATE, O.CUSTOMER_ID, O.DISCOUNT, OI.PRODUCT_ID, OI.QUANTITY, OI.SALES
FROM RAW.ORDERS O 
INNER JOIN RAW.ORDER_ITEMS OI ON O.ORDER_ID = OI.ORDER_ID

SELECT * FROM STG_ORDERS